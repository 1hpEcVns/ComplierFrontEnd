# 🌳 可视化 AST 编辑器

一个现代化的 Python 抽象语法树（AST）可视化编辑工具，采用类似 n8n/Zapier 的工作流设计，让您通过直观的界面对 Python 代码进行结构化编辑。

## ✨ 功能特性

### 🔍 核心功能

- **代码解析**：将 Python 源码解析为 AST 结构
- **可视化编辑**：通过图形界面进行 AST 操作
- **实时预览**：即时查看修改后的代码
- **安全执行**：在沙箱环境中运行生成的代码

### 🛠️ 转换操作

- **🏷️ 函数重命名**：批量重命名函数名和调用
- **📝 日志注入**：为函数自动添加日志输出
- **🔢 常量替换**：查找并替换代码中的常量值
- **🗑️ 语句删除**：按类型删除特定语句

### 📊 可视化功能

- **AST 结构树**：查看完整的抽象语法树结构
- **操作历史**：跟踪所有执行的转换操作
- **错误提示**：友好的错误信息和状态反馈

### 💾 工作流管理

- **保存工作流**：保存转换操作序列
- **加载预设**：使用预定义的转换模板
- **一键重置**：快速恢复到初始状态

## 🚀 快速开始

### 系统要求

- Python 3.8 或更高版本
- 现代浏览器（Chrome、Firefox、Safari、Edge）

### 安装运行

#### 方法 1：使用自动化脚本（推荐）

```bash
# 克隆项目
git clone <repository-url>
cd ast7

# 运行启动脚本（会自动创建虚拟环境并安装依赖）
./run.sh

# 停止服务器（在另一个终端窗口中）
./stop.sh
```

#### 方法 2：手动安装

```bash
# 创建虚拟环境
python3 -m venv venv

# 激活虚拟环境
source venv/bin/activate  # Linux/macOS
# 或
venv\Scripts\activate     # Windows

# 安装依赖
pip install -r requirements.txt

# 启动服务器
python app.py
```

### 访问应用

服务器启动后，在浏览器中访问：

```
http://127.0.0.1:5001
```

## 📖 使用指南

### 基本工作流

1. **输入代码**
   - 在左侧"源代码输入"区域输入 Python 代码
   - 点击"🔍 解析代码"按钮

2. **选择转换操作**
   - 在中间的"AST 转换操作"区域选择要执行的操作
   - 填写相应的参数
   - 点击对应的转换按钮

3. **查看结果**
   - 右侧"生成结果"区域显示转换后的代码
   - 点击"▶️ 运行代码"查看执行结果

### 转换操作详解

#### 🏷️ 重命名函数

- **功能**：重命名函数定义和所有调用点
- **参数**：
  - 原函数名：要重命名的函数名
  - 新函数名：新的函数名
- **示例**：将 `hello` 重命名为 `greet`

#### 📝 添加日志

- **功能**：在所有函数开头自动添加日志输出
- **参数**：
  - 日志消息：自定义日志前缀（默认："函数执行"）
- **效果**：每个函数开头会插入 `print("日志消息: 函数名")`

#### 🔢 替换常量

- **功能**：查找并替换代码中的常量值
- **参数**：
  - 原值：要替换的常量值
  - 新值：新的常量值
- **支持**：字符串、数字、布尔值等

#### 🗑️ 删除语句

- **功能**：按类型删除特定的语句
- **选项**：
  - 表达式语句
  - pass 语句
  - import 语句
  - from import 语句

### 高级功能

#### 🌲 AST 结构查看

- 点击"显示 AST"按钮查看当前代码的抽象语法树结构
- 可以看到每次转换对 AST 的具体影响

#### 💾 工作流管理

- **保存工作流**：输入名称后点击"保存工作流"
- **加载示例**：点击"加载示例工作流"体验预设操作
- **重置**：点击"重置"清空所有状态和结果

## 🏗️ 项目结构

```
ast7/
├── app.py              # Flask 后端服务器
├── index.html          # 前端页面
├── requirements.txt    # Python 依赖
├── run.sh             # 启动脚本
├── stop.sh            # 停止脚本
├── .gitignore         # Git 忽略文件
├── README.md          # 项目说明
├── ast7.md            # 项目设计文档
└── .venv/             # Python 虚拟环境（自动创建）
```

## 🔧 技术架构

### 后端 (Python + Flask)

- **AST 解析**：使用 Python `ast` 模块解析源码
- **转换引擎**：实现各种 AST 转换操作
- **代码生成**：将修改后的 AST 转回 Python 代码
- **安全执行**：在隔离环境中执行生成的代码

### 前端 (HTML + CSS + JavaScript)

- **响应式设计**：适配不同屏幕尺寸
- **现代 UI**：美观的渐变色和动画效果
- **实时反馈**：操作状态和错误提示
- **AST 可视化**：结构化显示抽象语法树

## ⚠️ 安全说明

- 本工具在受控环境中执行代码，但仍需谨慎对待输入的代码
- 生产环境部署时需要额外的安全措施
- 建议仅在可信环境中使用

## 🤝 贡献指南

欢迎提交 Issue 和 Pull Request 来改进这个项目！

### 后续扩展方向

- [ ] 支持更多编程语言
- [ ] 添加更多转换操作
- [ ] 实现真正的节点拖拽界面
- [ ] 支持工作流的持久化存储
- [ ] 添加语法高亮和代码折叠
- [ ] 支持批量文件处理

## 📝 许可证

MIT License - 详见 LICENSE 文件

## 🙏 致谢

感谢所有为这个项目提供想法和反馈的朋友们！

---

**Happy Coding! 🎉**
